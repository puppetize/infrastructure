#!/bin/sh
HOST='<%= ftp_host %>'
USER='<%= ftp_user %>'
PASSWORD='<%= ftp_password %>'

LOCAL='<%= bacula_storage_dir %>'
REMOTE='<%= ftp_directory %>'

case "$1" in
    up)
        lftp -f /dev/stdin <<EOF
set ssl:verify-certificate no
open -u ${USER},${PASSWORD} ${HOST}
mirror -Re ${LOCAL} ${REMOTE}
EOF
        ;;

    down)
        lftp -f /dev/stdin <<EOF
set ssl:verify-certificate no
open -u ${USER},${PASSWORD} ${HOST}
mirror -e ${REMOTE} ${LOCAL}
EOF
        ;;

    *)
        echo "$0: missing argument 'up' or 'down'"
        exit 2
        ;;
esac
